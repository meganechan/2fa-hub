# 2FA Hub - Google Authenticator Management System

## Project Overview
ระบบ Two-Factor Authentication (2FA) ด้วย Google Authenticator (TOTP)

## Tech Stack
- **Backend**: NestJS (TypeScript)
- **Frontend**: React + Vite + Tailwind CSS
- **Database**: MongoDB

## Local Development

### Prerequisites
- Node.js 20+
- MongoDB (Docker container: `mongodb`)
- tmux (for multi-agent coordination)
- Docker (for testing images)

### MongoDB Connection
```
Container: mongodb
Port: 27017
Connection: mongodb://localhost:27017/2fa-hub
```

### Start MongoDB (if not running)
```bash
docker start mongodb
```

### Start Services (tmux)
```bash
# Backend (detached mode)
./scripts/start-backend.sh    # Session: 2fa-backend

# Frontend (detached mode)
./scripts/start-frontend.sh   # Session: 2fa-frontend

# View logs
tmux attach -t 2fa-backend
tmux attach -t 2fa-frontend
```

### Manual Start (without tmux)
```bash
# Backend
cd backend
npm install
cp ../.env.example .env
npm run start:dev

# Frontend
cd frontend
npm install
npm run dev
```

## Agent Coordination

### tmux Sessions
- `2fa-backend`: Backend development server (port 3000)
- `2fa-frontend`: Frontend dev server (port 5173)

### Inbox Status Files (temp, changing)
- `inbox/backend-status.md`: Backend agent status
- `inbox/frontend-status.md`: Frontend agent status
- `inbox/shared-status.md`: Shared progress & blockers

### Context Files (stable, reference)
- `context/api-specs.md`: API endpoints & contracts
- `context/database-schema.md`: MongoDB schemas
- `context/environment.md`: Environment variables

### Protocol
1. เริ่ม task → อัปเดต status file ใน `inbox/`
2. ดู progress → อ่าน status files
3. แจ้ง blocker → เขียนใน status file
4. Sync → ใช้ `shared-status.md`
5. ดู API specs → อ่าน `context/api-specs.md`

## Docker Images

### Build Backend Image
```bash
cd backend
docker build -t 2fa-hub-backend .
```

### Build Frontend Image
```bash
cd frontend
docker build -t 2fa-hub-frontend .
```

### Test Locally
```bash
# Backend
docker run -p 3000:3000 --env-file .env 2fa-hub-backend

# Frontend
docker run -p 8080:80 2fa-hub-frontend
```

## Deployment (Coolify)

### Backend Service
- **Build Type**: Dockerfile
- **Dockerfile Path**: `backend/Dockerfile`
- **Port**: 3000
- **Environment Variables**: Set in Coolify

### Frontend Service
- **Build Type**: Dockerfile
- **Dockerfile Path**: `frontend/Dockerfile`
- **Port**: 80
- **Environment Variables**: `VITE_API_URL` (backend URL)

## API Endpoints

### Auth
- POST `/auth/register` - Register new user
- POST `/auth/login` - Login
- POST `/auth/verify-otp` - Verify OTP

### TOTP
- GET `/totp/setup` - Generate QR code
- POST `/totp/enable` - Enable 2FA
- POST `/totp/disable` - Disable 2FA
- GET `/totp/devices` - List devices
- POST `/totp/devices` - Add device
- DELETE `/totp/devices/:id` - Remove device
